# MyKVStore

> The README.md is generated by LLM, may make mistakes.

A tiny key-value store backed by MongoDB, with dictionary-style access in Python.

## What It Does
- Use `kvs[key]` to read values.
- Use `kvs[key] = value` to insert or update values.
- Use `del kvs[key]` to delete keys safely (no error if key is missing).
- Data is stored in fixed MongoDB database/collection names:
  - database: `mykvstore`
  - collection: `mykvstore`

## Requirements
- Python `>=3.9`
- `pymongo>=4.16.0`
- A valid MongoDB URI

## Installation
### With uv
```bash
uv add git+https://github.com/ninthseason/MyKVStore
```

### With pip
```bash
pip install git+https://github.com/ninthseason/MyKVStore
```

## Configuration
`KVStore` accepts an optional `uri` argument.

- If `uri` is provided, it is used directly.
- If `uri` is `None`, it resolves `MONGO_URI` in this order:
  1. Environment variable `MONGO_URI`
  2. Google Colab secret `MONGO_URI` (via `google.colab.userdata`)

### Set `MONGO_URI`
PowerShell:
```powershell
$env:MONGO_URI="mongodb+srv://<user>:<password>@<cluster-host>/"
```

Bash:
```bash
export MONGO_URI="mongodb+srv://<user>:<password>@<cluster-host>/"
```

## Quick Start
```python
from mykvstore import KVStore

# Use explicit URI, or omit it and rely on MONGO_URI
kvs = KVStore()

# Missing key -> None
print(kvs["example"])  # None

# Create
kvs["example"] = "hello, world!"
print(kvs["example"])  # hello, world!

# Update
kvs["example"] = "hello, new world!"
print(kvs["example"])  # hello, new world!

# None is allowed (stored as null in MongoDB)
kvs["example"] = None
print(kvs["example"])  # None

# Delete (safe even if key does not exist)
del kvs["example"]
print(kvs["example"])  # None
```

## Run Examples
```bash
uv run python examples/example.py
uv run python examples/perf_test.py
```

## API
### `KVStore(uri: str | None = None)`
Creates a MongoDB client and binds to fixed database/collection:
- database: `mykvstore`
- collection: `mykvstore`

If `uri` is `None`, calls `default_uri()`.

### `KVStore.default_uri() -> str`
Returns URI from:
1. Environment variable `MONGO_URI`
2. Google Colab secret `MONGO_URI` (if running in Colab)

Raises `RuntimeError` if neither source provides a URI.

### `kvs[key]` (`__getitem__`)
- Returns the stored value for `key`.
- Returns `None` when key does not exist.

### `kvs[key] = value` (`__setitem__`)
- Updates existing key value.
- Inserts new key when missing.

### `del kvs[key]` (`__delitem__`)
Deletes one record for key; no error if key is missing.

## Performance Warning
This library is a simple helper, not a high-throughput KV engine.

`examples/perf_test.py` includes a sample result around ~9s for 100 inserts (MongoDB Atlas free tier). Real performance depends on network latency, cluster tier, and index strategy.

## Notes
- Keys are stored in field `k`, values are stored in field `v`.
- Each set operation currently does a read-then-write pattern.
- Avoid committing real credentials to source control.
